<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>select</title>
<script src="https://cdn.jsdelivr.net/npm/lodash@4.17.11/lodash.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/vue/dist/vue.js"></script>
</head>
<body>
<!--
캐시 기능 때문에 산출 속성은 원래 데이터에 변경이 있을 때까지 처리를 추가로 실행하지 않습니다.
따라서 복잡한 처리를 하기에 적합합니다.
 -->
  <div id="app">
    <input v-model.number="budget">원 이하 필터링하기
    <input v-model.number="limit">개의 결과 출력하기
  <!--   <p>{{matched.length}}개 중에 {{limited.length}}개를 출력하고 있습니다.</p>  -->
        <ul>
      <li v-for="item in filteredList" v-bind:key="item.id">
         {{item.name}}  {{item.price}}원
      </li>
    </ul>
    
    <button v-on:click="change(order)">정렬하기</button>
  </div>
    <div  id="message"></div>
  <script>
   let message =document.getElementById("message");
    var app=new Vue({
    	el:'#app',
    	data:{
    		budget:500,
    		limit:2,
    		list:[
    			{id:1,name:'사과',price:100},
    			{id:2,name:'바나나',price:800},
    			{id:3,name:'딸기',price:400},
    			{id:4,name:'오렌지',price:300},
    			{id:5,name:'메론',price:500}
    		],
    		result:[],
    		order:false
    	},
    	computed:{
    		matched:function(){
    			message.innerHTML += ("matched"+"<br>")
    			return this.list.filter(function(item){  //list항목을 한 개씩 가져와서 price의 값과 budget를 비교해서
    				                                     //item.price <= this.budget 인 경우 리턴합니다.
    				return item.price <= this.budget      
    			},this)                                  //filter()안에서 사용할 this를 넘깁니다. 
    		},
    		sorted:function(){
    			message.innerHTML +=("this.order=" + this.order+"<br>")
    			return _.orderBy(this.matched, 'price', this.order ? 'desc':'asc');
    			
    		},
    		limited:function(){ //matched로 리턴한 데이터를 limit 조건을 걸어 리턴하는 산출 속성
    			//return this.matched.slice(0,this.limit) //slice(0,this.limit) : 0번 배열 요소에서 this.limit-1 요소까지 추출합니다.
    			message.innerHTML +=("limited"+"<br>")
    			return this.sorted.slice(0,this.limit);
    		},
    		filteredList:{ //최종사용할 결과로 사용할 속성을 리턴합니다.
    			get : function(){
    				message.innerHTML +=("filteredList get"+"<br>")
    				message.innerHTML +=("this.limited="+this.limited[0].id+"<br>");
        			return this.limited;
    			},
    			set : function(val){
    				message.innerHTML +=("set : " + val+"<br>")
    				return this.limited;
    			}
    				
    		}
    	},
    	methods:{
    		change(order){
    			this.order=!order;
    			message.innerHTML +=("change"+"<br>")
    			message.innerHTML +=("change this.limited="+this.limited[0].id+"<br>");
    			this.filteredList  =  _.orderBy(this.limited, 'price', this.order ? 'desc':'asc');
    		}
    	}
    })
  </script>
</body>
</html>